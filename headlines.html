<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Headline Browser</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./headlines.css">

<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>

<script type='text/javascript' src='/eel.js'></script>
<script type='text/javascript' src='/headlines.js'></script>

<!--

        
async function create_label(){
    
    let label = document.getElementById('label').value;

    label_div = document.getElementById('label_message');
    label_div.innerHTML = "loading...";
    
    let success = await eel.create_label(label)(); // Call to python function

    if(success){
        label_div.innerHTML = "Label: "+label;
        document.getElementById('label').style.display = "none";
        document.getElementById('label_button').style.display = "none";
        
        document.getElementById('filters').style.display = "block";
    }
    else{
        label_div.innerHTML = "Invalid label name: only letters, numbers, space, hyphen, and underscore are permitted";        
    }
}
       
       
async function add_annotation(index, positive=true){
    fields = data[index]
    console.log(index)
    console.log(fields)

    let message = await eel.add_annotation(fields, positive)(); // Call to python function
    
}       


 
async function get_positives_per_year(){
    let samples = await eel.get_positives_per_year()(); 
    console.log(samples);
    var count = 0;
    for (var year in samples) {
        console.log(year);
        headlines = samples[year];
        div_id = 'year_'+year;
        year_div = document.getElementById(div_id);
        year_div.innerHTML = '<h4>'+year+'</h4>';
        console.log(headlines);
        
        for(var headline_key in headlines){
            headline_details = headlines[headline_key];
            console.log(headline_details);
            headline = headline_details[1];
            url = headline_details[2];
            // year_div.innerHTML += '<a href="'+url+'" target="_blank">'+headline+'</a><br />';
            
            var link = document.createElement("a");   
            link.setAttribute('href', url);
            link.setAttribute('target', '_blank');
            link.setAttribute('style', 'display:block; clear:left;');
            link.innerText = headline;
            year_div.append(link);   
            count++; 
        }
    }
    
    if(count > 0){
        document.getElementById('examples').style.display = "block";
    }
}


var data = []
 
async function get_data_to_annotate(number=10){
    filter = document.getElementById("filter").value;
    console.log(filter)
    year = document.getElementById("year").value;
    console.log(year)
    
    data = await eel.get_data_to_annotate(number, filter, year)(); // Call to python function
    
    var i ;
    var tabindex = 1
    for(i=0; i <= 9; i++){
        message_id = "message_".concat(i.toString());
        message_div = document.getElementById(message_id);
        
        button_pos = '<button onclick="add_annotation('+i.toString()+');" tabindex="'+(tabindex++).toString()+'" >POS</button>';
        button_neg = '<button onclick="add_annotation('+i.toString()+',false);" tabindex="'+(tabindex++).toString()+'" >NEG</button>';
        
        console.log(i);
        if (data[i] === undefined){
            message_div.innerHTML = ""; // there were less than 10 results
        }
        else{
            headline = data[i][1];
            // TODO: add link?
            message_div.innerHTML = button_pos + button_neg +" " + headline;                
        }
    }
    
    document.getElementById('annotation').style.display = "block";

}
        
        
-->

</head>

<body class="w3-light-grey" style="margin-left:5px;">


<div class="w3-top w3-black">
  <span class="w3-bar-item">News Headline Classifier</span>
</div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:10px;margin-top:40px;">

        
<h5><div id='label_message'></div><input type="text" id='label' style="margin-left:10px;" /><button onclick="create_label();" id="label_button">Switch/Create New label</button></h5>


<div id="filters" style="display:none;">
<h4>Filters</h4>
Filter terms:<input type="text" id="filter">
Limit to year:<select id="year">
    <option value=""> none (all years) </option>
    <option value="2020">2020</option>
    <option value="2019">2019</option>
    <option value="2018">2018</option>
    <option value="2017">2017</option>
    <option value="2016">2016</option>
    <option value="2015">2015</option>
    <option value="2014">2014</option>
    <option value="2013">2013</option>
    <option value="2012">2012</option>
    <option value="2011">2011</option>
</select>
<br />
<button onclick="get_data_to_annotate();">Get Data to Annotate</button>

</div>

<div id="annotation" class="w3-left w3-striped w3-bordered w3-border" style="background-color:white; padding:10px; margin-top:10px; display:none;">
<h4>Annotate if part of the label (POS) or not (NEG):</h4>

    <div id="message_0"></div>
    <div id="message_1"></div>
    <div id="message_2"></div>
    <div id="message_3"></div>
    <div id="message_4"></div>
    <div id="message_5"></div>
    <div id="message_6"></div>
    <div id="message_7"></div>
    <div id="message_8"></div>
    <div id="message_9"></div>
    

<button onclick="get_positives_per_year();">Get Examples Per Year (if model has been trained)</button>


</div>

<div id="examples" class="w3-container" style="margin-top:10px; display:none;">
<h4>Examples</h4>

<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2020">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2019">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2018">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2017">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2016">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2015">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2014">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2013">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2012">
</div>
<div class="w3-left w3-striped w3-bordered w3-border" style="padding:10px; margin:5px;" id="year_2011">
</div>
</div>


</body></html>